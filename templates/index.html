<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Si / SiC / GaN Калкулатор</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <!-- Chart.js за графики -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1 id="mainTitle">Калкулатор: Si / SiC / GaN Транзистори</h1>
    <p class="lead" id="subtitle">Сравни загуби, ефективност и научи защо има разлики.</p>
    <div class="language-switcher">
      <button id="langBG" class="lang-btn active">БГ</button>
      <button id="langEN" class="lang-btn">EN</button>
    </div>
  </header>

  <main>
    <section class="controls">
      <h2 data-lang="inputParams">Въведи параметри</h2>
      <div class="row">
        <label class="tooltip-label"><span data-lang="technology">Технология</span>:
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Изберете тип полупроводник: Si (силиций) за стандартни приложения, SiC (силициев карбид) за висока ефективност и температура, GaN (галиев нитрид) за високочестотни приложения.</div>
          <select id="techSelect">
            <option value="Si">Si MOSFET / IGBT</option>
            <option value="SiC" selected>SiC MOSFET</option>
            <option value="GaN">GaN HEMT</option>
          </select>
        </label>

        <label class="tooltip-label"><span data-lang="maxVoltage">Макс. напрежение (V)</span>:
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Задайте максималното работно напрежение за вашето приложение. Транзисторът трябва да има VDS_max по-голямо от това значение с марж за безопасност (обикновено 1.5-2x).</div>
          <input id="maxVoltage" type="number" value="650" min="50" max="1500">
        </label>

        <label class="tooltip-label"><span data-lang="maxCurrent">Макс. ток (A)</span>:
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Задайте максималния постоянен ток през транзистора. Транзисторът трябва да може да провежда поне този ток с добро охлаждане.</div>
          <input id="maxCurrent" type="number" value="30" min="1" max="100">
        </label>
      </div>

      <div class="row">
        <label class="tooltip-label"><span data-lang="concreteModel">Конкретен модел</span>:
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Изберете конкретен транзистор от филтрираните по напрежение и ток. Всеки модел има реални параметри от datasheet-а на производителя.</div>
          <select id="transistorSelect">
            <option value="">Избери транзистор...</option>
          </select>
        </label>
      </div>

      <div class="row">
        <label class="tooltip-label">V<sub>DC</sub> (V):
          <span class="tooltip-icon">?</span>
          <div class="tooltip">DC напрежение на шината (Bus voltage). Това е напрежението, което транзисторът превключва. Трябва да е по-малко от VDS_max на избрания транзистор.</div>
          <input id="vdc" type="number" value="400">
        </label>

        <label class="tooltip-label">I<sub>load</sub> (A):
          <span class="tooltip-icon">?</span>
          <div class="tooltip">RMS ток през товара. Това е ефективната стойност на тока, който преминава през транзистора по време на проводимост.</div>
          <input id="iLoad" type="number" value="30">
        </label>

        <label class="tooltip-label">f<sub>sw</sub> (kHz):
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Честота на превключване. По-високата честота намалява размера на компонентите, но увеличава загубите от превключване. Типични стойности: Si (10-50kHz), SiC (50-200kHz), GaN (100kHz-1MHz).</div>
          <input id="fsw" type="number" value="100">
        </label>

        <label class="tooltip-label">T<sub>j</sub> (°C):
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Температура на p-n съединението (Junction temperature). Влияе на съпротивлението RDS(on). Типични стойности: 25°C (стайна), 100°C (работна), 150°C (максимална).</div>
          <input id="temp" type="number" value="25">
        </label>

        <label class="tooltip-label">Duty D:
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Коефициент на запълване (Duty cycle) - отношението между времето ON и периода. 0.5 означава 50% от времето транзисторът е включен. Влияе на загубите от проводимост.</div>
          <input id="duty" type="number" value="0.5" step="0.01" min="0.01" max="0.99">
        </label>
      </div>

      <div class="row">
        <button id="calcBtn" data-lang="calculate">Изчисли</button>
        <button id="suggestBtn" disabled data-lang="suggestOptimal">Предложи оптимални параметри</button>
        <button id="resetBtn" data-lang="reset">Възстанови стойности</button>
      </div>
    </section>

    <section class="results">
      <h2 data-lang="transistorInfo">Информация за транзистора</h2>
      <div id="transistorInfo" class="transistor-info" style="display: none;">
        <table>
          <tr><td data-lang="model">Модел</td><td id="modelName">—</td></tr>
          <tr><td data-lang="manufacturer">Производител</td><td id="manufacturer">—</td></tr>
          <tr><td data-lang="package">Корпус</td><td id="package">—</td></tr>
          <tr><td>V<sub>DS max</sub></td><td id="vdsMax">—</td></tr>
          <tr><td>I<sub>D max</sub></td><td id="idMax">—</td></tr>
          <tr><td>R<sub>DS(on)</sub></td><td id="rdsOn">—</td></tr>
          <tr><td data-lang="applications">Приложения</td><td id="application">—</td></tr>
        </table>
        <div id="parameterSuggestions"></div>
      </div>

      <div class="educational-info">
        <h3 data-lang="howToChoose">Как да избера подходящ транзистор?</h3>
        <p><strong>1. Напрежение:</strong> Изберете VDS_max поне 1.5-2x по-голямо от работното напрежение за марж за безопасност.</p>
        <p><strong>2. Ток:</strong> ID_max трябва да е по-голям от RMS тока с отчитане на термичните ограничения.</p>
        <p><strong>3. Честота:</strong> За високи честоти избирайте SiC/GaN с малки времена за превключване.</p>
        <p><strong>4. Ефективност:</strong> За висока ефективност търсете ниско RDS(on) и бързо превключване.</p>
      </div>

      <h2 data-lang="results">Резултати</h2>
      <table>
        <tr><td data-lang="conductionLosses">Conduction losses</td><td id="pCond">—</td></tr>
        <tr><td data-lang="switchingLosses">Switching losses</td><td id="pSw">—</td></tr>
        <tr><td data-lang="totalLosses">Total losses</td><td id="pTotal">—</td></tr>
        <tr><td data-lang="efficiency">КПД</td><td id="efficiency">—</td></tr>
      </table>

      <canvas id="lossChart"></canvas>

      <div class="explanation">
        <h2 data-lang="formulasTitle">Формули и обяснение</h2>
        <div id="explainText"></div>
      </div>
    </section>
  </main>

  <footer>
    <small>⚠️ Примерен калкулатор — стойностите са опростени. За реални проекти ползвай datasheet.</small>
  </footer>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
