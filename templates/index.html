<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Si / SiC / GaN Калкулатор</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <!-- Chart.js за графики -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1 id="mainTitle">Калкулатор: Si / SiC / GaN Транзистори</h1>
    <p class="lead" id="subtitle">Научно обяснение, формули и графики.</p>
    <div class="language-switcher">
      <button id="langBG" class="lang-btn active">БГ</button>
      <button id="langEN" class="lang-btn">EN</button>
    </div>
  </header>

  <main>
    <section class="controls">
      <h2 data-lang="inputParams">Въведи параметри</h2>
      <div class="row">
        <label class="input-group">
          <span data-lang="technology">Технология</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Изберете тип полупроводник: Si (силиций) за стандартни приложения, SiC (силициев карбид) за висока ефективност и температура, GaN (галиев нитрид) за високочестотни приложения.</div>
          <select id="techSelect">
            <option value="Si">Si MOSFET / IGBT</option>
            <option value="SiC" selected>SiC MOSFET</option>
            <option value="GaN">GaN HEMT</option>
          </select>
        </label>

        <label class="input-group">
          <span data-lang="maxVoltage">Макс. напрежение (V)</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Задайте максималното работно напрежение за вашето приложение. Транзисторът трябва да има VDS_max по-голямо от това значение с марж за безопасност (обикновено 1.5-2x).</div>
          <input id="maxVoltage" type="number" value="650" min="50" max="1500">
        </label>

        <label class="input-group">
          <span data-lang="maxCurrent">Макс. ток (A)</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Задайте максималния постоянен ток през транзистора. Транзисторът трябва да може да провежда поне този ток с добро охлаждане.</div>
          <input id="maxCurrent" type="number" value="30" min="1" max="100">
        </label>
      </div>

      <div class="row">
        <label class="input-group">
          <span data-lang="concreteModel">Конкретен модел</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Изберете конкретен транзистор от филтрираните по напрежение и ток. Всеки модел има реални параметри от datasheet-а на производителя.</div>
          <select id="transistorSelect">
            <option value="">Избери транзистор...</option>
          </select>
        </label>
      </div>

      <div class="row">
        <label class="input-group">
          <span>V<sub>DC</sub> напрежение (V)</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">DC напрежение на шината (Bus voltage). Това е напрежението, което транзисторът превключва. Трябва да е по-малко от VDS_max на избрания транзистор.</div>
          <input id="vdc" type="number" value="400">
        </label>

        <label class="input-group">
          <span>I<sub>load</sub> ток (A)</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">RMS ток през товара. Това е ефективната стойност на тока, който преминава през транзистора по време на проводимост.</div>
          <input id="iLoad" type="number" value="30">
        </label>
      </div>

      <div class="row">
        <label class="input-group">
          <span>f<sub>sw</sub> честота (kHz)</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Честота на превключване. По-високата честота намалява размера на компонентите, но увеличава загубите от превключване. Типични стойности: Si (10-50kHz), SiC (50-200kHz), GaN (100kHz-1MHz).</div>
          <input id="fsw" type="number" value="100">
        </label>

        <label class="input-group">
          <span>T<sub>j</sub> температура (°C)</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Температура на p-n съединението (Junction temperature). Влияе на съпротивлението RDS(on). Типични стойности: 25°C (стайна), 100°C (работна), 150°C (максимална).</div>
          <input id="temp" type="number" value="25">
        </label>
      </div>

      <div class="row">
        <label class="input-group">
          <span>Duty коефициент запълване</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Коефициент на запълване (Duty cycle) - отношението между времето ON и периода. 0.5 означава 50% от времето транзисторът е включен. Влияе на загубите от проводимост.</div>
          <input id="duty" type="number" value="0.5" step="0.01" min="0.01" max="0.99">
        </label>
      </div>

      <div class="button-row">
        <button id="calcBtn" data-lang="calculate">Изчисли</button>
        <button id="suggestBtn" disabled data-lang="suggestOptimal">Предложи оптимални параметри</button>
        <button id="resetBtn" data-lang="reset">Възстанови стойности</button>
      </div>
    </section>

    <section class="results">
      <h2 data-lang="transistorInfo">Информация за транзистора</h2>
      <div id="transistorInfo" class="transistor-info" style="display: none;">
        <table>
          <tr><td data-lang="model">Модел</td><td id="modelName">—</td></tr>
          <tr><td data-lang="manufacturer">Производител</td><td id="manufacturer">—</td></tr>
          <tr><td data-lang="package">Корпус</td><td id="package">—</td></tr>
          <tr><td>V<sub>DS max</sub></td><td id="vdsMax">—</td></tr>
          <tr><td>I<sub>D max</sub></td><td id="idMax">—</td></tr>
          <tr><td>R<sub>DS(on)</sub></td><td id="rdsOn">—</td></tr>
          <tr><td data-lang="applications">Приложения</td><td id="application">—</td></tr>
        </table>
        <div id="parameterSuggestions"></div>
      </div>

      <div class="educational-info">
        <h3 data-lang="howToChoose">Как да избера подходящ транзистор?</h3>
        <p><strong>1. Напрежение:</strong> Изберете VDS_max поне 1.5-2x по-голямо от работното напрежение за марж за безопасност.</p>
        <p><strong>2. Ток:</strong> ID_max трябва да е по-голям от RMS тока с отчитане на термичните ограничения.</p>
        <p><strong>3. Честота:</strong> За високи честоти избирайте SiC/GaN с малки времена за превключване.</p>
        <p><strong>4. Ефективност:</strong> За висока ефективност търсете ниско RDS(on) и бързо превключване.</p>
      </div>

      <h2 data-lang="results">Резултати</h2>
      <table>
        <tr><td data-lang="conductionLosses">Conduction losses</td><td id="pCond">—</td></tr>
        <tr><td data-lang="switchingLosses">Switching losses</td><td id="pSw">—</td></tr>
        <tr><td data-lang="totalLosses">Total losses</td><td id="pTotal">—</td></tr>
        <tr><td data-lang="efficiency">КПД</td><td id="efficiency">—</td></tr>
      </table>

      <canvas id="lossChart"></canvas>

      <div class="explanation">
        <h2 data-lang="formulasTitle">Формули и обяснение</h2>
        <div id="explainText"></div>
      </div>
    </section>

    <!-- Нова секция за графики на ефективност vs честота -->
    <section class="analysis">
      <h2 data-lang="efficiencyAnalysis">Анализ на ефективност vs честота</h2>
      <p data-lang="efficiencyDescription">Тази графика показва как се променя ефективността при различни честоти за Si, SiC и GaN технологиите.</p>
      
      <div class="analysis-controls">
        <label class="input-group">
          <span data-lang="frequencyRange">Честотен обхват</span>
          <span class="tooltip-icon">?</span>
          <div class="tooltip">Задайте честотния обхват за анализ. Препоръчително: 1-500kHz за Si, 10-1000kHz за SiC, 50-2000kHz за GaN.</div>
          <div class="frequency-range">
            <label>От: <input id="freqMin" type="number" value="10" min="1" max="100"> kHz</label>
            <label>До: <input id="freqMax" type="number" value="500" min="10" max="2000"> kHz</label>
          </div>
        </label>
        
        <button id="generateEffChart" data-lang="generateChart">Генерирай графика</button>
      </div>
      
      <canvas id="efficiencyChart" style="display: none;"></canvas>
      <div id="efficiencyInsights" class="insights-box" style="display: none;"></div>
    </section>

    <!-- Нова секция за термично моделиране -->
    <section class="thermal">
      <h2 data-lang="thermalModeling">Термично моделиране</h2>
      <p data-lang="thermalDescription">Анализира как се загрява транзисторът и дали е необходимо охлаждане. Изчислява температурите на полупроводниковия чип (junction) и корпуса въз основа на мощността на загубите.</p>
      
      <div class="thermal-controls">
        <div class="row">
          <label class="input-group">
            <span data-lang="ambientTemp">Околна температура (°C)</span>
            <span class="tooltip-icon">?</span>
            <div class="tooltip">Температурата на околната среда. Типични стойности: 25°C (стайна), 40°C (промишлена), 70°C (автомобилна).</div>
            <input id="ambientTemp" type="number" value="25" min="-40" max="85">
          </label>

          <label class="input-group">
            <span data-lang="coolingType">Тип охлаждане</span>
            <span class="tooltip-icon">?</span>
            <div class="tooltip">Изберете тип охлаждане:<br><strong>Естествено:</strong> само корпуса (50°C/W)<br><strong>Малък радиатор:</strong> 10-20cm² Fischer SK104 (15°C/W)<br><strong>Среден радиатор:</strong> 50-100cm² Fischer SK129 (6°C/W)<br><strong>Голям радиатор:</strong> >200cm² Fischer SK53 (2.5°C/W)<br><strong>Принудително въздушно:</strong> с вентилатор 1-2m/s (1.5°C/W)<br><strong>Течно охлаждане:</strong> измерено (0.3°C/W)</div>
            <select id="coolingType">
              <option value="natural" data-lang-option="naturalCooling">Естествено (само корпус, 50°C/W)</option>
              <option value="small_heatsink" data-lang-option="smallHeatsink">Малък радиатор (Fischer SK104, 15°C/W)</option>
              <option value="medium_heatsink" data-lang-option="mediumHeatsink">Среден радиатор (Fischer SK129, 6°C/W)</option>
              <option value="large_heatsink" data-lang-option="largeHeatsink">Голям радиатор (Fischer SK53, 2.5°C/W)</option>
              <option value="forced_air" data-lang-option="forcedAir">Принудително въздушно (с вентилатор, 1.5°C/W)</option>
              <option value="liquid_cooling" data-lang-option="liquidCooling">Течно охлаждане (измерено, 0.3°C/W)</option>
            </select>
          </label>
        </div>

        <button id="calculateThermal" data-lang="calculateThermal">Изчисли термични параметри</button>
      </div>

      <div id="thermalResults" class="thermal-results" style="display: none;">
        <h3 data-lang="thermalResults">Термични резултати</h3>
        <div id="thermalStatus" class="thermal-status" style="display: none;"></div>
        <table>
          <tr><td data-lang="junctionTemp">Температура на съединението (Tj)</td><td id="junctionTemp">—</td></tr>
          <tr><td data-lang="caseTemp">Температура на корпуса (Tc)</td><td id="caseTemp">—</td></tr>
          <tr><td data-lang="thermalResistance">Термично съпротивление (Rth)</td><td id="thermalResistance">—</td></tr>
          <tr><td data-lang="thermalMargin">Термичен марж</td><td id="thermalMargin">—</td></tr>
        </table>
        <div id="thermalExplanation" style="margin-top: 15px; font-size: 14px; color: #555;"></div>
        <div id="thermalWarnings" class="warning-box" style="display: none;"></div>
      </div>
    </section>
  </main>

  <footer>
    <small>⚠️ Примерен калкулатор — стойностите са опростени. За реални проекти ползвай datasheet.</small>
  </footer>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
